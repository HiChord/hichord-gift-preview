<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Your HiChord is on its way!</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0a0c;
      --surface: #151518;
      --surface-raised: #1c1c20;
      --surface-glow: #1f1f24;
      --border: #2a2a32;
      --border-light: #3a3a44;
      --text: #ffffff;
      --text-dim: #8888a0;
      --text-muted: #555566;
      --cyan: #00e5ff;
      --cyan-dim: rgba(0, 229, 255, 0.12);
      --cyan-glow: rgba(0, 229, 255, 0.35);
      --orange: #ff7043;
      --orange-dim: rgba(255, 112, 67, 0.12);
      --orange-glow: rgba(255, 112, 67, 0.35);
      --yellow: #ffd54f;
      --yellow-dim: rgba(255, 213, 79, 0.15);
      --pink: #ff4081;
      --green: #69f0ae;
      --green-dim: rgba(105, 240, 174, 0.15);
      --red: #ff5252;
      --red-dim: rgba(255, 82, 82, 0.15);
      --major: #4dabf7;
      --major-glow: rgba(77, 171, 247, 0.4);
      --minor: #b197fc;
      --minor-glow: rgba(177, 151, 252, 0.4);
      --dim: #ff8787;
      --dim-glow: rgba(255, 135, 135, 0.4);
      --radius: 12px;
      --radius-lg: 20px;
      --radius-xl: 28px;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.6;
      overflow-x: hidden;
    }
    .bg-glow {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      pointer-events: none; z-index: 0; overflow: hidden;
    }
    .bg-glow::before {
      content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
      background: radial-gradient(ellipse at 30% 20%, var(--cyan-dim) 0%, transparent 50%),
                  radial-gradient(ellipse at 70% 80%, var(--orange-dim) 0%, transparent 50%),
                  radial-gradient(ellipse at 50% 50%, rgba(177, 151, 252, 0.05) 0%, transparent 60%);
      animation: bgFloat 20s ease-in-out infinite;
    }
    @keyframes bgFloat {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      33% { transform: translate(2%, 2%) rotate(1deg); }
      66% { transform: translate(-2%, 1%) rotate(-1deg); }
    }
    .container { max-width: 1000px; margin: 0 auto; padding: 32px 20px; position: relative; z-index: 1; }

    /* Hero */
    .hero { text-align: center; padding: 40px 0 56px; }
    .hero-badge {
      display: inline-flex; align-items: center; gap: 8px;
      background: linear-gradient(135deg, var(--cyan-dim) 0%, var(--orange-dim) 100%);
      padding: 10px 20px; border-radius: 50px; font-size: 14px; font-weight: 600;
      margin-bottom: 20px; border: 1px solid var(--border);
      animation: badgePulse 3s ease-in-out infinite;
    }
    @keyframes badgePulse {
      0%, 100% { box-shadow: 0 0 20px var(--cyan-dim); }
      50% { box-shadow: 0 0 30px var(--cyan-glow); }
    }
    .hero h1 { font-size: clamp(32px, 7vw, 56px); font-weight: 900; margin-bottom: 12px; letter-spacing: -0.03em; }
    .hero h1 .gradient-text {
      background: linear-gradient(135deg, var(--cyan) 0%, var(--orange) 50%, var(--pink) 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .hero-subtitle { color: var(--text-dim); font-size: 17px; max-width: 460px; margin: 0 auto 24px; }
    .hero-image { margin: 32px auto; max-width: 400px; }
    .product-img { width: 100%; height: auto; filter: drop-shadow(0 20px 40px rgba(0, 229, 255, 0.15)); animation: heroFloat 4s ease-in-out infinite; }
    @keyframes heroFloat { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-8px) rotate(1deg); } }
    .hero-cta { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
    .btn {
      display: inline-flex; align-items: center; gap: 8px; padding: 14px 28px;
      font-size: 15px; font-weight: 600; border-radius: var(--radius);
      cursor: pointer; transition: all 0.2s ease; text-decoration: none; border: none;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--cyan) 0%, #00b8d4 100%);
      color: #000; box-shadow: 0 4px 20px var(--cyan-glow);
    }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 30px var(--cyan-glow); }
    .btn-secondary { background: var(--surface-raised); color: var(--text); border: 1px solid var(--border); }
    .btn-secondary:hover { border-color: var(--cyan); background: var(--surface-glow); }

    /* Big Callout */
    .big-callout {
      text-align: center; padding: 32px; margin-bottom: 40px;
      background: linear-gradient(135deg, var(--cyan-dim) 0%, var(--orange-dim) 100%);
      border: 1px solid var(--border); border-radius: var(--radius-xl);
    }
    .big-callout h2 { font-size: 28px; font-weight: 800; margin-bottom: 8px; }
    .big-callout .highlight { color: var(--cyan); }
    .big-callout p { color: var(--text-dim); font-size: 16px; }

    /* Stats Row */
    .stats-row {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 16px; margin-bottom: 48px;
    }
    .stat-card {
      background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-lg);
      padding: 20px; text-align: center;
    }
    .stat-number { font-size: 32px; font-weight: 800; color: var(--cyan); }
    .stat-label { font-size: 12px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.05em; }

    /* Features Grid */
    .features-section { padding: 40px 0; }
    .section-header { text-align: center; margin-bottom: 32px; }
    .section-tag { font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; color: var(--orange); margin-bottom: 8px; }
    .section-title { font-size: clamp(24px, 5vw, 36px); font-weight: 800; margin-bottom: 8px; }
    .section-subtitle { color: var(--text-dim); font-size: 15px; max-width: 500px; margin: 0 auto; }
    .features-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; }
    .feature-card {
      background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-lg);
      padding: 24px; transition: all 0.3s ease; position: relative; overflow: hidden;
    }
    .feature-card::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
      background: linear-gradient(90deg, var(--cyan) 0%, var(--orange) 100%);
      opacity: 0; transition: opacity 0.3s;
    }
    .feature-card:hover { border-color: var(--border-light); transform: translateY(-4px); box-shadow: 0 16px 32px rgba(0, 0, 0, 0.3); }
    .feature-card:hover::before { opacity: 1; }
    .feature-icon { width: 44px; height: 44px; border-radius: var(--radius); display: flex; align-items: center; justify-content: center; font-size: 22px; margin-bottom: 12px; }
    .feature-icon.cyan { background: var(--cyan-dim); }
    .feature-icon.orange { background: var(--orange-dim); }
    .feature-icon.yellow { background: var(--yellow-dim); }
    .feature-icon.green { background: var(--green-dim); }
    .feature-icon.red { background: var(--red-dim); }
    .feature-title { font-size: 16px; font-weight: 700; margin-bottom: 6px; }
    .feature-desc { color: var(--text-dim); font-size: 13px; line-height: 1.5; }

    /* Synth Section */
    .synth-section { padding: 40px 0; }
    .synth-card {
      background: linear-gradient(180deg, var(--surface) 0%, var(--bg) 100%);
      border: 1px solid var(--border); border-radius: var(--radius-xl);
      padding: 32px; position: relative; overflow: hidden;
    }
    .synth-card::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
      background: linear-gradient(90deg, transparent 0%, var(--cyan) 50%, transparent 100%);
    }
    .synth-header { text-align: center; margin-bottom: 24px; }
    .synth-header h2 { font-size: 24px; font-weight: 800; margin-bottom: 6px; }
    .synth-header p { color: var(--text-dim); font-size: 14px; }

    /* Controls Row */
    .controls-row { display: flex; justify-content: center; align-items: center; gap: 24px; margin-bottom: 24px; flex-wrap: wrap; }
    .control-group { display: flex; align-items: center; gap: 10px; }
    .control-label { font-size: 12px; color: var(--text-dim); font-weight: 500; }
    .key-controls { display: flex; align-items: center; gap: 4px; background: var(--surface-raised); border-radius: var(--radius); padding: 4px; border: 1px solid var(--border); }
    .key-btn { width: 32px; height: 32px; background: transparent; border: none; border-radius: 6px; color: var(--text); font-size: 14px; cursor: pointer; transition: all 0.15s; }
    .key-btn:hover { background: var(--cyan-dim); color: var(--cyan); }
    .key-display { font-family: 'JetBrains Mono', monospace; font-size: 16px; font-weight: 700; min-width: 36px; text-align: center; color: var(--cyan); }
    .volume-slider { width: 80px; height: 6px; -webkit-appearance: none; background: var(--border); border-radius: 3px; outline: none; }
    .volume-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; background: var(--cyan); border-radius: 50%; cursor: pointer; }

    /* Chord Display */
    .chord-display {
      text-align: center; margin-bottom: 32px; padding: 28px;
      background: var(--surface-raised); border-radius: var(--radius-lg);
      border: 1px solid var(--border); position: relative; overflow: hidden;
    }
    .chord-display::before { content: ''; position: absolute; inset: 0; background: radial-gradient(ellipse at center, var(--cyan-dim) 0%, transparent 70%); opacity: 0; transition: opacity 0.3s; }
    .chord-display.active::before { opacity: 1; }
    .chord-name {
      font-family: 'JetBrains Mono', monospace; font-size: clamp(44px, 10vw, 64px); font-weight: 700;
      color: var(--cyan); min-height: 70px; display: flex; align-items: center; justify-content: center;
      text-shadow: 0 0 40px var(--cyan-glow); position: relative; z-index: 1;
    }
    .chord-name.playing { animation: chordPulse 0.3s ease-out; }
    @keyframes chordPulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    .chord-info { display: flex; justify-content: center; gap: 20px; margin-top: 8px; position: relative; z-index: 1; }
    .chord-detail { font-size: 13px; color: var(--text-dim); }
    .chord-detail span { color: var(--text); font-weight: 600; }
    .joystick-mod-display { font-family: 'JetBrains Mono', monospace; font-size: 13px; color: var(--orange); margin-top: 6px; min-height: 18px; position: relative; z-index: 1; }

    /* Synth Layout */
    .synth-layout { display: grid; grid-template-columns: 1fr auto; gap: 40px; align-items: start; }
    @media (max-width: 800px) { .synth-layout { grid-template-columns: 1fr; gap: 32px; } }

    /* HiChord Buttons */
    .hichord-buttons { display: flex; flex-direction: column; gap: 12px; width: 100%; max-width: 480px; margin: 0 auto; }
    .button-row { display: flex; justify-content: center; gap: 10px; }
    .top-row { padding: 0 50px; }
    .hichord-btn {
      background: var(--surface-raised); border: 2px solid var(--border); border-radius: var(--radius-lg);
      padding: 14px 10px; text-align: center; flex: 1; max-width: 100px; cursor: pointer;
      transition: all 0.15s ease; user-select: none; position: relative; overflow: hidden;
    }
    .hichord-btn::before { content: ''; position: absolute; inset: 0; background: radial-gradient(circle at center, currentColor 0%, transparent 70%); opacity: 0; transition: opacity 0.2s; }
    .hichord-btn:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4); }
    .hichord-btn.active::before { opacity: 0.15; }
    .hichord-btn.btn-1, .hichord-btn.btn-4, .hichord-btn.btn-5 { border-color: var(--major); color: var(--major); }
    .hichord-btn.btn-1.active, .hichord-btn.btn-4.active, .hichord-btn.btn-5.active { background: rgba(77, 171, 247, 0.15); box-shadow: 0 0 25px var(--major-glow); }
    .hichord-btn.btn-2, .hichord-btn.btn-3, .hichord-btn.btn-6 { border-color: var(--minor); color: var(--minor); }
    .hichord-btn.btn-2.active, .hichord-btn.btn-3.active, .hichord-btn.btn-6.active { background: rgba(177, 151, 252, 0.15); box-shadow: 0 0 25px var(--minor-glow); }
    .hichord-btn.btn-7 { border-color: var(--dim); color: var(--dim); }
    .hichord-btn.btn-7.active { background: rgba(255, 135, 135, 0.15); box-shadow: 0 0 25px var(--dim-glow); }
    .hbtn-number { font-family: 'JetBrains Mono', monospace; font-size: 24px; font-weight: 800; margin-bottom: 2px; position: relative; z-index: 1; }
    .hbtn-chord { font-size: 14px; font-weight: 700; color: var(--text); position: relative; z-index: 1; }

    /* Combined Joystick */
    .joystick-container { display: flex; flex-direction: column; align-items: center; gap: 12px; }
    .joystick-title { font-size: 14px; font-weight: 700; color: var(--orange); margin-bottom: 4px; }
    .joystick-grid-wrapper { position: relative; }
    .joystick-grid {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; width: 200px;
    }
    .joy-cell {
      background: var(--surface-raised); border: 2px solid var(--border); border-radius: var(--radius);
      padding: 10px 6px; text-align: center; cursor: pointer; transition: all 0.15s; min-height: 60px;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
    }
    .joy-cell:hover { border-color: var(--orange); background: var(--orange-dim); }
    .joy-cell.active { border-color: var(--orange); background: var(--orange-dim); box-shadow: 0 0 15px var(--orange-glow); }
    .joy-cell.center { background: var(--cyan-dim); border-color: var(--cyan); cursor: default; }
    .joy-cell.center:hover { background: var(--cyan-dim); }
    .joy-arrow { font-size: 16px; margin-bottom: 2px; }
    .joy-mod { font-family: 'JetBrains Mono', monospace; font-size: 10px; font-weight: 700; color: var(--orange); }
    .joy-cell.center .joy-mod { color: var(--cyan); }
    .joystick-hint { font-size: 11px; color: var(--text-muted); text-align: center; max-width: 180px; }

    /* Keyboard hints */
    .keyboard-hints { display: flex; justify-content: center; gap: 24px; margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border); flex-wrap: wrap; }
    .hint-group { display: flex; align-items: center; gap: 6px; color: var(--text-dim); font-size: 12px; }
    .kbd { display: inline-flex; align-items: center; justify-content: center; min-width: 24px; height: 24px; padding: 0 6px; background: var(--surface-raised); border: 1px solid var(--border); border-radius: 4px; font-family: 'JetBrains Mono', monospace; font-size: 11px; font-weight: 600; color: var(--text); }

    /* Piano Keyboard */
    .piano-container { margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border); }
    .piano-label { font-size: 12px; color: var(--text-dim); text-align: center; margin-bottom: 12px; }
    .piano { display: flex; justify-content: center; position: relative; height: 100px; }
    .piano-keys { display: flex; position: relative; }
    .white-key {
      width: 32px; height: 100px; background: linear-gradient(180deg, #f8f8f8 0%, #e8e8e8 100%);
      border: 1px solid #bbb; border-radius: 0 0 4px 4px; margin-right: -1px;
      position: relative; z-index: 1; transition: all 0.1s;
    }
    .white-key.active { background: linear-gradient(180deg, var(--cyan) 0%, #00b8d4 100%); border-color: var(--cyan); }
    .white-key.active.bass { background: linear-gradient(180deg, var(--orange) 0%, #e65100 100%); border-color: var(--orange); }
    .black-key {
      width: 20px; height: 60px; background: linear-gradient(180deg, #333 0%, #111 100%);
      border: 1px solid #000; border-radius: 0 0 3px 3px;
      position: absolute; z-index: 2; margin-left: -10px; transition: all 0.1s;
    }
    .black-key.active { background: linear-gradient(180deg, var(--cyan) 0%, #00b8d4 100%); border-color: var(--cyan); }
    .black-key.active.bass { background: linear-gradient(180deg, var(--orange) 0%, #e65100 100%); border-color: var(--orange); }
    .piano-note-label { position: absolute; bottom: 4px; left: 50%; transform: translateX(-50%); font-size: 9px; color: #666; font-family: 'JetBrains Mono', monospace; }
    .white-key.active .piano-note-label { color: #000; font-weight: 700; }
    .piano-legend { display: flex; justify-content: center; gap: 20px; margin-top: 10px; font-size: 11px; }
    .legend-item { display: flex; align-items: center; gap: 6px; color: var(--text-dim); }
    .legend-dot { width: 12px; height: 12px; border-radius: 2px; }
    .legend-dot.chord { background: var(--cyan); }
    .legend-dot.bass { background: var(--orange); }

    /* Keyboard Guide */
    .keyboard-guide { width: 100%; }
    .guide-title { font-size: 14px; font-weight: 700; color: var(--cyan); margin-bottom: 12px; text-align: center; }
    .guide-content { display: flex; flex-direction: column; gap: 16px; }
    .guide-section { text-align: center; }
    .guide-label { font-size: 12px; color: var(--text-dim); margin-bottom: 10px; }
    .key-mapping { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; }
    .key-pair { display: flex; align-items: center; gap: 3px; background: var(--surface-raised); padding: 6px 10px; border-radius: 6px; border: 1px solid var(--border); }
    .maps-to { color: var(--text-muted); font-size: 10px; }
    .btn-num { font-family: 'JetBrains Mono', monospace; font-size: 14px; font-weight: 700; color: var(--cyan); }
    .guide-or { font-size: 11px; color: var(--text-muted); margin-top: 10px; }
    .guide-or .kbd { margin: 0 2px; }
    .guide-row { display: flex; justify-content: center; gap: 24px; flex-wrap: wrap; }

    /* Chord System Explainer */
    .explainer-section { padding: 40px 0; }
    .explainer-card {
      background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-xl);
      padding: 32px; text-align: center;
    }
    .explainer-title { font-size: 22px; font-weight: 800; margin-bottom: 16px; }
    .explainer-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; max-width: 600px; margin: 0 auto 24px; }
    .explainer-btn {
      background: var(--surface-raised); border: 2px solid var(--border); border-radius: var(--radius);
      padding: 12px 8px; text-align: center;
    }
    .explainer-btn.major { border-color: var(--major); }
    .explainer-btn.minor { border-color: var(--minor); }
    .explainer-btn.dim { border-color: var(--dim); }
    .explainer-num { font-family: 'JetBrains Mono', monospace; font-size: 18px; font-weight: 800; }
    .explainer-roman { font-size: 11px; color: var(--text-dim); margin-top: 2px; }
    .explainer-feel { font-size: 9px; color: var(--text-muted); margin-top: 4px; }
    .explainer-text { color: var(--text-dim); font-size: 14px; max-width: 600px; margin: 0 auto; line-height: 1.7; }
    .explainer-text strong { color: var(--cyan); font-weight: 600; }

    /* Resources Section */
    .resources-section { padding: 40px 0; }
    .resources-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; }
    .resource-card {
      background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-lg);
      padding: 24px; text-decoration: none; transition: all 0.3s ease; display: block;
    }
    .resource-card:hover { border-color: var(--cyan); transform: translateY(-4px); box-shadow: 0 16px 32px rgba(0, 0, 0, 0.3); }
    .resource-icon { font-size: 32px; margin-bottom: 12px; }
    .resource-title { font-size: 18px; font-weight: 700; color: var(--text); margin-bottom: 8px; }
    .resource-desc { font-size: 13px; color: var(--text-dim); line-height: 1.5; margin-bottom: 12px; }
    .resource-link { font-size: 12px; color: var(--cyan); font-weight: 600; }

    /* Footer */
    .footer { text-align: center; padding: 40px 20px; border-top: 1px solid var(--border); margin-top: 40px; }
    .footer-logo { font-size: 22px; font-weight: 800; margin-bottom: 12px; background: linear-gradient(135deg, var(--cyan) 0%, var(--orange) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .footer-links { display: flex; justify-content: center; gap: 24px; margin-bottom: 12px; flex-wrap: wrap; }
    .footer-links a { color: var(--text-dim); text-decoration: none; font-size: 13px; font-weight: 500; transition: color 0.2s; }
    .footer-links a:hover { color: var(--cyan); }
    .footer p { color: var(--text-dim); font-size: 13px; margin-bottom: 6px; }
    .footer a { color: var(--cyan); text-decoration: none; font-weight: 600; }
    .footer a:hover { text-decoration: underline; }

    /* Start Overlay */
    .start-overlay {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(10, 10, 12, 0.95); backdrop-filter: blur(20px);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      z-index: 1000; gap: 24px; padding: 20px;
    }
    .start-overlay.hidden { display: none; }
    .start-content { text-align: center; max-width: 400px; }
    .start-icon { font-size: 56px; margin-bottom: 20px; animation: float 3s ease-in-out infinite; }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    .start-title { font-size: 28px; font-weight: 800; margin-bottom: 10px; }
    .start-subtitle { color: var(--text-dim); font-size: 15px; margin-bottom: 28px; }
    .start-btn {
      padding: 16px 40px; font-size: 17px; font-weight: 700;
      background: linear-gradient(135deg, var(--cyan) 0%, #00b8d4 100%); color: #000;
      border: none; border-radius: var(--radius-lg); cursor: pointer;
      box-shadow: 0 8px 32px var(--cyan-glow); transition: all 0.2s;
    }
    .start-btn:hover { transform: scale(1.05); box-shadow: 0 12px 40px var(--cyan-glow); }
    .start-hint { margin-top: 20px; font-size: 12px; color: var(--text-muted); }
    .start-keys { display: flex; gap: 4px; justify-content: center; margin-top: 8px; }
    .start-keys .kbd { background: var(--surface); }

    /* Mobile */
    @media (max-width: 600px) {
      .container { padding: 20px 16px; }
      .hero { padding: 28px 0 40px; }
      .synth-card { padding: 20px 16px; }
      .top-row { padding: 0 16px; }
      .hichord-btn { padding: 10px 6px; max-width: 80px; }
      .hbtn-number { font-size: 20px; }
      .joystick-grid { width: 170px; }
      .joy-cell { padding: 8px 4px; min-height: 52px; }
      .explainer-grid { grid-template-columns: repeat(4, 1fr); }
      .explainer-grid .explainer-btn:nth-child(5),
      .explainer-grid .explainer-btn:nth-child(6),
      .explainer-grid .explainer-btn:nth-child(7) { grid-column: span 1; }
    }
  </style>
</head>
<body>
  <div class="bg-glow"></div>

  <!-- Start Overlay -->
  <div class="start-overlay" id="startOverlay">
    <div class="start-content">
      <div class="start-icon">üéÅ</div>
      <h2 class="start-title">Your Gift Awaits!</h2>
      <p class="start-subtitle">Try HiChord's magical chord system right now while you wait for the real thing to arrive!</p>
      <button class="start-btn" id="startBtn">Start Playing</button>
      <p class="start-hint">Play chords with keys 1-7 or:</p>
      <div class="start-keys">
        <span class="kbd">A</span><span class="kbd">W</span><span class="kbd">S</span><span class="kbd">E</span><span class="kbd">D</span><span class="kbd">R</span><span class="kbd">F</span>
      </div>
      <p class="start-hint" style="margin-top: 8px; font-size: 10px; color: var(--text-muted);">(A=1, W=2, S=3, E=4, D=5, R=6, F=7)</p>
    </div>
  </div>

  <div class="container">
    <!-- Hero -->
    <section class="hero">
      <div class="hero-badge"><span>üéÅ</span><span>Your HiChord is on its way!</span></div>
      <h1><span class="gradient-text">A Gift is Coming</span></h1>
      <p class="hero-subtitle">Play this interactive preview while you wait. The real thing is even more amazing!</p>
      <div class="hero-image">
        <img src="hichord-aluminum.png" alt="HiChord - The chord-based synthesizer" class="product-img">
      </div>
      <div class="hero-cta">
        <a href="#synth" class="btn btn-primary">Play Now</a>
        <a href="https://hichord.shop" target="_blank" class="btn btn-secondary">Learn More</a>
      </div>
    </section>

    <!-- Big Callout -->
    <div class="big-callout">
      <h2><span class="highlight">No Wrong Notes!</span></h2>
      <p>Press ANY button, ANY combination. They ALWAYS sound good together.</p>
    </div>

    <!-- Stats -->
    <div class="stats-row">
      <div class="stat-card"><div class="stat-number">7</div><div class="stat-label">Chord Buttons</div></div>
      <div class="stat-card"><div class="stat-number">12</div><div class="stat-label">Oscillators</div></div>
      <div class="stat-card"><div class="stat-number">6000+</div><div class="stat-label">Chord Voicings</div></div>
      <div class="stat-card"><div class="stat-number">25+</div><div class="stat-label">Sound Presets</div></div>
    </div>

    <!-- Features -->
    <section class="features-section">
      <div class="section-header">
        <div class="section-tag">What's Inside</div>
        <h2 class="section-title">Meet HiChord</h2>
        <p class="section-subtitle">Pick up. Play. Anywhere.</p>
      </div>
      <div class="features-grid">
        <div class="feature-card">
          <div class="feature-icon cyan">üéπ</div>
          <h3 class="feature-title">7 Chord Buttons</h3>
          <p class="feature-desc">Each button plays a chord that works with all the others. Music theory built in!</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon orange">üïπÔ∏è</div>
          <h3 class="feature-title">Magic Joystick</h3>
          <p class="feature-desc">Push in any direction to modify chords. Add 7ths, swap major/minor, thousands of options!</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon yellow">üéõÔ∏è</div>
          <h3 class="feature-title">Sound Engine</h3>
          <p class="feature-desc">Analog, FM, and sampled sounds. From dreamy pads to punchy leads.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon green">üîä</div>
          <h3 class="feature-title">Built-in Speaker</h3>
          <p class="feature-desc">Battery powered with USB-C. Play anywhere without cables!</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon red">üéöÔ∏è</div>
          <h3 class="feature-title">Effects</h3>
          <p class="feature-desc">Filter, chorus, flanger, delay, reverb. Make your sound huge!</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon cyan">üîÅ</div>
          <h3 class="feature-title">Looper</h3>
          <p class="feature-desc">Record 2 tracks and build songs. Click to record, loop, and layer!</p>
        </div>
      </div>
    </section>

    <!-- Synth Section -->
    <section class="synth-section" id="synth">
      <div class="synth-card">
        <div class="synth-header">
          <h2>Try It Now!</h2>
          <p>Click buttons or use your keyboard. Hold a chord and click the joystick directions!</p>
        </div>

        <!-- Controls -->
        <div class="controls-row">
          <div class="control-group">
            <span class="control-label">Key</span>
            <div class="key-controls">
              <button class="key-btn" id="keyLeft">‚Üê</button>
              <span class="key-display" id="keyDisplay">C</span>
              <button class="key-btn" id="keyRight">‚Üí</button>
            </div>
          </div>
          <div class="control-group">
            <span class="control-label">üîä</span>
            <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50">
          </div>
        </div>

        <!-- Chord Display -->
        <div class="chord-display" id="chordDisplay">
          <div class="chord-name" id="chordName">‚Äî</div>
          <div class="chord-info">
            <div class="chord-detail">Button: <span id="chordButton">-</span></div>
            <div class="chord-detail">Roman: <span id="chordRoman">-</span></div>
          </div>
          <div class="joystick-mod-display" id="joystickMod"></div>
        </div>

        <!-- Synth Layout -->
        <div class="synth-layout">
          <!-- Chord Buttons -->
          <div class="hichord-buttons">
            <div class="button-row top-row">
              <div class="hichord-btn btn-2" data-button="2">
                <div class="hbtn-number">2</div>
                <div class="hbtn-chord" id="chord2">Dm</div>
              </div>
              <div class="hichord-btn btn-4" data-button="4">
                <div class="hbtn-number">4</div>
                <div class="hbtn-chord" id="chord4">F</div>
              </div>
              <div class="hichord-btn btn-6" data-button="6">
                <div class="hbtn-number">6</div>
                <div class="hbtn-chord" id="chord6">Am</div>
              </div>
            </div>
            <div class="button-row bottom-row">
              <div class="hichord-btn btn-1" data-button="1">
                <div class="hbtn-number">1</div>
                <div class="hbtn-chord" id="chord1">C</div>
              </div>
              <div class="hichord-btn btn-3" data-button="3">
                <div class="hbtn-number">3</div>
                <div class="hbtn-chord" id="chord3">Em</div>
              </div>
              <div class="hichord-btn btn-5" data-button="5">
                <div class="hbtn-number">5</div>
                <div class="hbtn-chord" id="chord5">G</div>
              </div>
              <div class="hichord-btn btn-7" data-button="7">
                <div class="hbtn-number">7</div>
                <div class="hbtn-chord" id="chord7">Bdim</div>
              </div>
            </div>
          </div>

          <!-- Combined Joystick Grid -->
          <div class="joystick-container">
            <div class="joystick-title">üïπÔ∏è JOYSTICK</div>
            <div class="joystick-grid-wrapper">
              <div class="joystick-grid" id="joystickGrid">
                <div class="joy-cell" data-dir="up-left"><span class="joy-arrow">‚Üñ</span><span class="joy-mod">aug</span></div>
                <div class="joy-cell" data-dir="up"><span class="joy-arrow">‚Üë</span><span class="joy-mod">M‚Üîm</span></div>
                <div class="joy-cell" data-dir="up-right"><span class="joy-arrow">‚Üó</span><span class="joy-mod">dom7</span></div>
                <div class="joy-cell" data-dir="left"><span class="joy-arrow">‚Üê</span><span class="joy-mod">dim</span></div>
                <div class="joy-cell center" data-dir="center"><span class="joy-arrow">‚óè</span><span class="joy-mod">default</span></div>
                <div class="joy-cell" data-dir="right"><span class="joy-arrow">‚Üí</span><span class="joy-mod">maj7</span></div>
                <div class="joy-cell" data-dir="down-left"><span class="joy-arrow">‚Üô</span><span class="joy-mod">6th</span></div>
                <div class="joy-cell" data-dir="down"><span class="joy-arrow">‚Üì</span><span class="joy-mod">sus4</span></div>
                <div class="joy-cell" data-dir="down-right"><span class="joy-arrow">‚Üò</span><span class="joy-mod">add9</span></div>
              </div>
            </div>
            <span class="joystick-hint">Hold chord + click direction, or use arrow keys</span>
          </div>
        </div>

        <!-- Piano Visualization -->
        <div class="piano-container">
          <div class="piano-label">Notes being played:</div>
          <div class="piano">
            <div class="piano-keys" id="pianoKeys"></div>
          </div>
          <div class="piano-legend">
            <div class="legend-item"><div class="legend-dot chord"></div><span>Chord notes</span></div>
            <div class="legend-item"><div class="legend-dot bass"></div><span>Bass note</span></div>
          </div>
        </div>

        <!-- Keyboard Controls Guide -->
        <div class="keyboard-hints">
          <div class="keyboard-guide">
            <div class="guide-title">üéπ Keyboard Controls</div>
            <div class="guide-content">
              <div class="guide-section">
                <div class="guide-label">Play Chords (same as clicking buttons 1-7):</div>
                <div class="key-mapping">
                  <div class="key-pair"><span class="kbd">A</span><span class="maps-to">=</span><span class="btn-num">1</span></div>
                  <div class="key-pair"><span class="kbd">W</span><span class="maps-to">=</span><span class="btn-num">2</span></div>
                  <div class="key-pair"><span class="kbd">S</span><span class="maps-to">=</span><span class="btn-num">3</span></div>
                  <div class="key-pair"><span class="kbd">E</span><span class="maps-to">=</span><span class="btn-num">4</span></div>
                  <div class="key-pair"><span class="kbd">D</span><span class="maps-to">=</span><span class="btn-num">5</span></div>
                  <div class="key-pair"><span class="kbd">R</span><span class="maps-to">=</span><span class="btn-num">6</span></div>
                  <div class="key-pair"><span class="kbd">F</span><span class="maps-to">=</span><span class="btn-num">7</span></div>
                </div>
                <div class="guide-or">or just press <span class="kbd">1</span> <span class="kbd">2</span> <span class="kbd">3</span> <span class="kbd">4</span> <span class="kbd">5</span> <span class="kbd">6</span> <span class="kbd">7</span></div>
              </div>
              <div class="guide-row">
                <div class="hint-group"><span class="kbd">‚Üë</span><span class="kbd">‚Üì</span><span class="kbd">‚Üê</span><span class="kbd">‚Üí</span><span>Joystick</span></div>
                <div class="hint-group"><span class="kbd">[</span><span class="kbd">]</span><span>Change Key</span></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Chord System Explainer -->
    <section class="explainer-section">
      <div class="explainer-card">
        <h3 class="explainer-title">The 7 Buttons = The 7 Chords of Music</h3>
        <div class="explainer-grid">
          <div class="explainer-btn major"><div class="explainer-num">1</div><div class="explainer-roman">I</div><div class="explainer-feel">Home</div></div>
          <div class="explainer-btn minor"><div class="explainer-num">2</div><div class="explainer-roman">ii</div><div class="explainer-feel">Lift</div></div>
          <div class="explainer-btn minor"><div class="explainer-num">3</div><div class="explainer-roman">iii</div><div class="explainer-feel">Color</div></div>
          <div class="explainer-btn major"><div class="explainer-num">4</div><div class="explainer-roman">IV</div><div class="explainer-feel">Rise</div></div>
          <div class="explainer-btn major"><div class="explainer-num">5</div><div class="explainer-roman">V</div><div class="explainer-feel">Tension</div></div>
          <div class="explainer-btn minor"><div class="explainer-num">6</div><div class="explainer-roman">vi</div><div class="explainer-feel">Emotion</div></div>
          <div class="explainer-btn dim"><div class="explainer-num">7</div><div class="explainer-roman">vii¬∞</div><div class="explainer-feel">Drama</div></div>
        </div>
        <p class="explainer-text">
          In every key, there are exactly <strong>7 chords that naturally sound good together</strong>.
          HiChord puts one on each button. Try <strong>1 ‚Üí 5 ‚Üí 6 ‚Üí 4</strong> - that's the most popular progression in pop music!
          Or <strong>1 ‚Üí 4 ‚Üí 5</strong> for classic rock. The magic is: <strong>ANY combination works!</strong>
        </p>
      </div>
    </section>

    <!-- Resources Section -->
    <section class="resources-section">
      <div class="section-header">
        <div class="section-tag">Get Ready</div>
        <h2 class="section-title">Resources</h2>
        <p class="section-subtitle">Everything you need to master HiChord</p>
      </div>
      <div class="resources-grid">
        <a href="https://manual.hichord.shop" target="_blank" class="resource-card">
          <div class="resource-icon">üìñ</div>
          <h3 class="resource-title">Online Manual</h3>
          <p class="resource-desc">Complete guide to all features, modes, and hidden tricks</p>
          <span class="resource-link">manual.hichord.shop</span>
        </a>
        <a href="https://app.hichord.shop" target="_blank" class="resource-card">
          <div class="resource-icon">üì±</div>
          <h3 class="resource-title">Companion App</h3>
          <p class="resource-desc">Update firmware, customize settings, and unlock new sounds</p>
          <span class="resource-link">app.hichord.shop</span>
        </a>
        <a href="https://hichord.shop" target="_blank" class="resource-card">
          <div class="resource-icon">üõí</div>
          <h3 class="resource-title">Shop</h3>
          <p class="resource-desc">Learn more about HiChord and see all the details</p>
          <span class="resource-link">hichord.shop</span>
        </a>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-logo">HiChord</div>
      <div class="footer-links">
        <a href="https://hichord.shop" target="_blank">Shop</a>
        <a href="https://manual.hichord.shop" target="_blank">Manual</a>
        <a href="https://app.hichord.shop" target="_blank">Companion App</a>
      </div>
      <p style="font-size: 11px; color: var(--text-muted); margin-top: 12px;">This is just a taste ‚Äî the real thing has way more sounds, effects, looper, drums, and more!</p>
    </footer>
  </div>

  <script>
    // =========================================================================
    // MUSIC THEORY
    // =========================================================================
    const NOTES = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
    const KEYS_CIRCLE = ['C', 'G', 'D', 'A', 'E', 'B', 'F#', 'C#', 'G#', 'D#', 'A#', 'F'];
    const SCALE_INTERVALS = [0, 2, 4, 5, 7, 9, 11];
    const CHORDS = [
      { roman: 'I', type: 'Major', suffix: '' },
      { roman: 'ii', type: 'minor', suffix: 'm' },
      { roman: 'iii', type: 'minor', suffix: 'm' },
      { roman: 'IV', type: 'Major', suffix: '' },
      { roman: 'V', type: 'Major', suffix: '' },
      { roman: 'vi', type: 'minor', suffix: 'm' },
      { roman: 'vii¬∞', type: 'dim', suffix: 'dim' }
    ];
    const CHORD_INTERVALS = {
      major: [0, 4, 7], minor: [0, 3, 7], dim: [0, 3, 6], aug: [0, 4, 8],
      sus4: [0, 5, 7], sus2: [0, 2, 7], maj7: [0, 4, 7, 11], min7: [0, 3, 7, 10],
      dom7: [0, 4, 7, 10], dim7: [0, 3, 6, 9], add9: [0, 4, 7, 14], min9: [0, 3, 7, 10, 14], '6': [0, 4, 7, 9]
    };
    const JOY_MODS = {
      up: { major: { type: 'minor', suffix: 'm' }, minor: { type: 'major', suffix: '' }, dim: { type: 'minor', suffix: 'm' } },
      down: { major: { type: 'sus4', suffix: 'sus4' }, minor: { type: 'sus4', suffix: 'sus4' }, dim: { type: 'sus4', suffix: 'sus4' } },
      left: { major: { type: 'dim', suffix: 'dim' }, minor: { type: 'dim', suffix: 'dim' }, dim: { type: 'dim', suffix: 'dim' } },
      right: { major: { type: 'maj7', suffix: 'maj7' }, minor: { type: 'min7', suffix: 'm7' }, dim: { type: 'dim7', suffix: 'dim7' } },
      'up-left': { major: { type: 'aug', suffix: 'aug' }, minor: { type: 'aug', suffix: 'aug' }, dim: { type: 'aug', suffix: 'aug' } },
      'up-right': { major: { type: 'dom7', suffix: '7' }, minor: { type: 'dom7', suffix: '7' }, dim: { type: 'dom7', suffix: '7' } },
      'down-left': { major: { type: '6', suffix: '6' }, minor: { type: 'sus2', suffix: 'sus2' }, dim: { type: '6', suffix: '6' } },
      'down-right': { major: { type: 'add9', suffix: 'add9' }, minor: { type: 'min9', suffix: 'm9' }, dim: { type: 'add9', suffix: 'add9' } }
    };

    // =========================================================================
    // STATE
    // =========================================================================
    let ctx = null, master = null, oscs = [], currentKey = 'C', activeBtn = null, joyDir = null, started = false;
    let currentPlayingNotes = { bass: null, chord: [] };

    // =========================================================================
    // PIANO KEYBOARD VISUALIZATION
    // =========================================================================
    const PIANO_START = 36; // C2 (bass notes)
    const PIANO_END = 84;   // C6 (high chord notes)
    const WHITE_NOTES = [0, 2, 4, 5, 7, 9, 11]; // C, D, E, F, G, A, B offsets
    const BLACK_NOTE_OFFSETS = { 1: 0.65, 3: 1.65, 6: 3.65, 8: 4.65, 10: 5.65 }; // C#, D#, F#, G#, A#

    function buildPiano() {
      const container = document.getElementById('pianoKeys');
      if (!container) return;
      container.innerHTML = '';

      // Calculate number of octaves
      const startOctave = Math.floor(PIANO_START / 12);
      const endOctave = Math.floor(PIANO_END / 12);

      // Build white keys first
      for (let midi = PIANO_START; midi <= PIANO_END; midi++) {
        const noteInOctave = midi % 12;
        if (WHITE_NOTES.includes(noteInOctave)) {
          const key = document.createElement('div');
          key.className = 'white-key';
          key.dataset.midi = midi;

          // Add note label for C notes
          if (noteInOctave === 0) {
            const label = document.createElement('span');
            label.className = 'piano-note-label';
            label.textContent = 'C' + Math.floor(midi / 12 - 1);
            key.appendChild(label);
          }

          container.appendChild(key);
        }
      }

      // Build black keys with absolute positioning
      let whiteKeyIndex = 0;
      for (let midi = PIANO_START; midi <= PIANO_END; midi++) {
        const noteInOctave = midi % 12;
        if (WHITE_NOTES.includes(noteInOctave)) {
          whiteKeyIndex++;
        } else if (BLACK_NOTE_OFFSETS[noteInOctave] !== undefined) {
          const key = document.createElement('div');
          key.className = 'black-key';
          key.dataset.midi = midi;
          // Position relative to white keys
          const octaveStart = Math.floor(midi / 12) * 7 - Math.floor(PIANO_START / 12) * 7;
          const posInOctave = BLACK_NOTE_OFFSETS[noteInOctave];
          key.style.left = ((octaveStart + posInOctave) * 32 - 1) + 'px';
          container.appendChild(key);
        }
      }
    }

    function updatePiano(bassNote, chordNotes) {
      // Clear all active keys
      document.querySelectorAll('.piano-keys .white-key, .piano-keys .black-key').forEach(key => {
        key.classList.remove('active', 'bass');
      });

      currentPlayingNotes = { bass: bassNote, chord: chordNotes };

      // Highlight bass note (orange)
      if (bassNote !== null) {
        const bassKey = document.querySelector(`.piano-keys [data-midi="${bassNote}"]`);
        if (bassKey) {
          bassKey.classList.add('active', 'bass');
        }
      }

      // Highlight chord notes (cyan)
      chordNotes.forEach(midi => {
        const key = document.querySelector(`.piano-keys [data-midi="${midi}"]`);
        if (key) {
          key.classList.add('active');
        }
      });
    }

    function clearPiano() {
      document.querySelectorAll('.piano-keys .white-key, .piano-keys .black-key').forEach(key => {
        key.classList.remove('active', 'bass');
      });
      currentPlayingNotes = { bass: null, chord: [] };
    }

    // =========================================================================
    // AUDIO ENGINE - Double detuned oscillators with panning + bass
    // =========================================================================
    function initAudio() {
      ctx = new (window.AudioContext || window.webkitAudioContext)();
      master = ctx.createGain();
      master.gain.value = 0.35;

      // Reverb
      const reverb = ctx.createConvolver();
      const len = ctx.sampleRate * 1.5;
      const impulse = ctx.createBuffer(2, len, ctx.sampleRate);
      for (let ch = 0; ch < 2; ch++) {
        const d = impulse.getChannelData(ch);
        for (let i = 0; i < len; i++) d[i] = (Math.random() * 2 - 1) * Math.exp(-i / (ctx.sampleRate * 0.4));
      }
      reverb.buffer = impulse;

      const dry = ctx.createGain(), wet = ctx.createGain();
      dry.gain.value = 0.75; wet.gain.value = 0.25;
      master.connect(ctx.destination);
      dry.connect(master); wet.connect(master); reverb.connect(wet);

      window.audio = { dry, reverb };
      started = true;
      document.getElementById('startOverlay').classList.add('hidden');
    }

    function midiToFreq(m) { return 440 * Math.pow(2, (m - 69) / 12); }

    function getRootMidi(btn, key) {
      return 60 + NOTES.indexOf(key) + SCALE_INTERVALS[btn - 1];
    }

    function playChord(btn) {
      if (!started) return;
      stopOscs();

      const info = CHORDS[btn - 1];
      let baseType = info.type.toLowerCase(), chordType = baseType, suffix = info.suffix;

      if (joyDir && JOY_MODS[joyDir]) {
        const mod = JOY_MODS[joyDir][baseType];
        if (mod) { chordType = mod.type; suffix = mod.suffix; }
      }

      const rootMidi = getRootMidi(btn, currentKey);
      const intervals = CHORD_INTERVALS[chordType] || CHORD_INTERVALS.major;
      const midiNotes = intervals.map(i => rootMidi + i);

      // Bass note - 2 octaves down, mono center
      const bassNote = rootMidi - 24;
      createOsc(bassNote, 0.12, 0, false); // center, no detune pair

      // Chord notes - stereo detuned pairs
      midiNotes.forEach((midi, i) => {
        const pan = (i - (midiNotes.length - 1) / 2) * 0.4; // spread across stereo
        createOsc(midi, 0.05, pan, true); // with detune pair
      });

      // Update piano visualization
      updatePiano(bassNote, midiNotes);

      // Update display
      const keyIdx = NOTES.indexOf(currentKey);
      const rootNote = NOTES[(keyIdx + SCALE_INTERVALS[btn - 1]) % 12];

      const nameEl = document.getElementById('chordName');
      nameEl.textContent = rootNote + suffix;
      nameEl.classList.add('playing');
      setTimeout(() => nameEl.classList.remove('playing'), 300);

      document.getElementById('chordButton').textContent = btn;
      document.getElementById('chordRoman').textContent = info.roman;
      document.getElementById('chordDisplay').classList.add('active');

      if (joyDir) {
        const arrows = { up: '‚Üë', down: '‚Üì', left: '‚Üê', right: '‚Üí', 'up-left': '‚Üñ', 'up-right': '‚Üó', 'down-left': '‚Üô', 'down-right': '‚Üò' };
        document.getElementById('joystickMod').textContent = `Joystick: ${arrows[joyDir]} ${suffix || 'toggle'}`;
      } else {
        document.getElementById('joystickMod').textContent = '';
      }
    }

    function createOsc(midi, vol, pan, withPair) {
      const freq = midiToFreq(midi);

      // Main osc - panned
      const osc1 = ctx.createOscillator();
      const gain1 = ctx.createGain();
      const pan1 = ctx.createStereoPanner();

      osc1.type = 'sawtooth';
      osc1.frequency.value = freq;
      osc1.detune.value = -6 + Math.random() * 2;

      gain1.gain.value = 0;
      gain1.gain.setTargetAtTime(vol, ctx.currentTime, 0.012);
      pan1.pan.value = Math.max(-1, Math.min(1, pan - 0.15));

      osc1.connect(gain1);
      gain1.connect(pan1);
      pan1.connect(window.audio.dry);
      pan1.connect(window.audio.reverb);
      osc1.start();
      oscs.push({ osc: osc1, gain: gain1 });

      if (withPair) {
        // Detuned pair - opposite pan
        const osc2 = ctx.createOscillator();
        const gain2 = ctx.createGain();
        const pan2 = ctx.createStereoPanner();

        osc2.type = 'sawtooth';
        osc2.frequency.value = freq;
        osc2.detune.value = 6 + Math.random() * 2;

        gain2.gain.value = 0;
        gain2.gain.setTargetAtTime(vol * 0.7, ctx.currentTime, 0.012);
        pan2.pan.value = Math.max(-1, Math.min(1, pan + 0.15));

        osc2.connect(gain2);
        gain2.connect(pan2);
        pan2.connect(window.audio.dry);
        pan2.connect(window.audio.reverb);
        osc2.start();
        oscs.push({ osc: osc2, gain: gain2 });
      }
    }

    function stopOscs() {
      oscs.forEach(({ osc, gain }) => {
        gain.gain.setTargetAtTime(0, ctx.currentTime, 0.06);
        setTimeout(() => { try { osc.stop(); } catch(e) {} }, 120);
      });
      oscs = [];
    }

    function stopChord() {
      stopOscs();
      clearPiano();
      document.getElementById('chordName').textContent = '‚Äî';
      document.getElementById('chordButton').textContent = '-';
      document.getElementById('chordRoman').textContent = '-';
      document.getElementById('joystickMod').textContent = '';
      document.getElementById('chordDisplay').classList.remove('active');
    }

    // =========================================================================
    // UI
    // =========================================================================
    function updateKeyDisplay() {
      document.getElementById('keyDisplay').textContent = currentKey;
      for (let btn = 1; btn <= 7; btn++) {
        const keyIdx = NOTES.indexOf(currentKey);
        const rootNote = NOTES[(keyIdx + SCALE_INTERVALS[btn - 1]) % 12];
        document.getElementById(`chord${btn}`).textContent = rootNote + CHORDS[btn - 1].suffix;
      }
    }

    function changeKey(dir) {
      const idx = KEYS_CIRCLE.indexOf(currentKey);
      currentKey = KEYS_CIRCLE[(idx + (dir === 'left' ? -1 : 1) + 12) % 12];
      updateKeyDisplay();
      if (activeBtn) playChord(activeBtn);
    }

    function activateBtn(num) {
      if (!started) initAudio();
      activeBtn = num;
      document.querySelectorAll('.hichord-btn').forEach(b => b.classList.remove('active'));
      document.querySelector(`[data-button="${num}"]`)?.classList.add('active');
      playChord(num);
    }

    function deactivateBtn() {
      activeBtn = null;
      document.querySelectorAll('.hichord-btn').forEach(b => b.classList.remove('active'));
      stopChord();
    }

    function setJoyDir(dir) {
      joyDir = dir === 'center' ? null : dir;
      document.querySelectorAll('.joy-cell').forEach(c => c.classList.remove('active'));
      if (dir) document.querySelector(`[data-dir="${dir}"]`)?.classList.add('active');
      if (activeBtn) playChord(activeBtn);
    }

    // =========================================================================
    // EVENT HANDLERS
    // =========================================================================
    // Chord buttons
    document.querySelectorAll('.hichord-btn').forEach(btn => {
      const num = parseInt(btn.dataset.button);
      btn.addEventListener('mousedown', e => { e.preventDefault(); activateBtn(num); });
      btn.addEventListener('touchstart', e => { e.preventDefault(); activateBtn(num); });
    });

    document.addEventListener('mouseup', () => { if (activeBtn) deactivateBtn(); });
    document.addEventListener('touchend', e => {
      const touch = e.changedTouches[0];
      const el = document.elementFromPoint(touch.clientX, touch.clientY);
      if (!el?.closest('.hichord-btn')) deactivateBtn();
    });

    // Joystick grid - clickable
    document.querySelectorAll('.joy-cell').forEach(cell => {
      const dir = cell.dataset.dir;
      cell.addEventListener('mousedown', () => setJoyDir(dir));
      cell.addEventListener('touchstart', e => { e.preventDefault(); setJoyDir(dir); });
    });
    document.addEventListener('mouseup', () => setJoyDir('center'));
    document.addEventListener('touchend', () => setJoyDir('center'));

    // Keyboard - AWSEDRF + 1-7 for chords, arrows for joystick
    const keyMap = { KeyA: 1, KeyW: 2, KeyS: 3, KeyE: 4, KeyD: 5, KeyR: 6, KeyF: 7 };
    const held = new Set();
    const kbJoy = { up: false, down: false, left: false, right: false };

    function updateKbJoy() {
      let x = 0, y = 0;
      if (kbJoy.left) x--; if (kbJoy.right) x++;
      if (kbJoy.up) y--; if (kbJoy.down) y++;

      let dir = null;
      if (y < 0 && x < 0) dir = 'up-left';
      else if (y < 0 && x > 0) dir = 'up-right';
      else if (y > 0 && x < 0) dir = 'down-left';
      else if (y > 0 && x > 0) dir = 'down-right';
      else if (y < 0) dir = 'up';
      else if (y > 0) dir = 'down';
      else if (x < 0) dir = 'left';
      else if (x > 0) dir = 'right';

      setJoyDir(dir || 'center');
    }

    document.addEventListener('keydown', e => {
      if (held.has(e.code)) return;
      held.add(e.code);

      // Number keys 1-7
      if (e.code >= 'Digit1' && e.code <= 'Digit7') {
        activateBtn(parseInt(e.code.replace('Digit', '')));
        return;
      }

      // AWSEDRF keys
      if (keyMap[e.code]) {
        activateBtn(keyMap[e.code]);
        return;
      }

      // Arrow keys for joystick - prevent default to stop page scrolling
      if (e.code === 'ArrowUp') { e.preventDefault(); kbJoy.up = true; updateKbJoy(); return; }
      if (e.code === 'ArrowDown') { e.preventDefault(); kbJoy.down = true; updateKbJoy(); return; }
      if (e.code === 'ArrowLeft') { e.preventDefault(); kbJoy.left = true; updateKbJoy(); return; }
      if (e.code === 'ArrowRight') { e.preventDefault(); kbJoy.right = true; updateKbJoy(); return; }

      // Key change
      if (e.code === 'BracketLeft') changeKey('left');
      if (e.code === 'BracketRight') changeKey('right');
    });

    document.addEventListener('keyup', e => {
      held.delete(e.code);

      // Number keys
      if (e.code >= 'Digit1' && e.code <= 'Digit7') {
        const num = parseInt(e.code.replace('Digit', ''));
        if (activeBtn === num) deactivateBtn();
        return;
      }

      // AWSEDRF keys
      if (keyMap[e.code] && activeBtn === keyMap[e.code]) {
        deactivateBtn();
        return;
      }

      // Arrow keys
      if (e.code === 'ArrowUp') { kbJoy.up = false; updateKbJoy(); }
      if (e.code === 'ArrowDown') { kbJoy.down = false; updateKbJoy(); }
      if (e.code === 'ArrowLeft') { kbJoy.left = false; updateKbJoy(); }
      if (e.code === 'ArrowRight') { kbJoy.right = false; updateKbJoy(); }
    });

    // UI buttons
    document.getElementById('keyLeft').addEventListener('click', () => changeKey('left'));
    document.getElementById('keyRight').addEventListener('click', () => changeKey('right'));
    document.getElementById('volumeSlider').addEventListener('input', e => {
      if (master) master.gain.value = e.target.value / 150;
    });
    document.getElementById('startBtn').addEventListener('click', initAudio);
    document.querySelector('.btn-primary').addEventListener('click', e => {
      e.preventDefault();
      document.getElementById('synth').scrollIntoView({ behavior: 'smooth' });
      if (!started) setTimeout(initAudio, 400);
    });

    updateKeyDisplay();
    buildPiano();
  </script>
</body>
</html>
